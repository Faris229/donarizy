<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Prompt', sans-serif; display: flex; margin: 0; background: #f0f2f5; height: 100vh; }
        .sidebar { width: 250px; background: #1f2937; color: white; padding: 20px; }
        .main { flex: 1; padding: 20px; overflow-y: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .btn { padding: 5px 10px; border: none; border-radius: 5px; color: white; cursor: pointer; }
        #login { position: fixed; inset: 0; background: #1f2937; display: flex; justify-content: center; align-items: center; z-index: 999; }
        input { padding: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="login">
    <div style="background:white; padding:30px; border-radius:10px; width:300px; text-align:center;">
        <h2>Admin Login</h2>
        <input id="a-email" placeholder="Email (farisxuma1@gmail.com)">
        <input id="a-pass" type="password" placeholder="Password">
        <button onclick="doLogin()" style="width:100%; padding:10px; background:#3b82f6; color:white; border:none; cursor:pointer;">Login</button>
    </div>
</div>

<div class="sidebar">
    <h3>Admin Control</h3>
    <p onclick="show('users')" style="cursor:pointer">üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
    <p onclick="show('tx')" style="cursor:pointer">üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</p>
    <button onclick="auth.signOut()" style="margin-top:20px; background:red; color:white; border:none; padding:5px;">Logout</button>
</div>

<div class="main">
    <div id="p-users" class="card">
        <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
        <div id="u-list">Loading...</div>
    </div>
    <div id="p-tx" class="card" style="display:none;">
        <h3>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <div id="tx-list">Loading...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script>
    const config = { apiKey: "AIzaSy...", authDomain: "...", projectId: "..." }; // ‚ö†Ô∏è ‡πÉ‡∏™‡πà Config
    try { firebase.initializeApp(config); } catch(e){}
    const auth = firebase.auth(), db = firebase.firestore();
    let users = {};

    auth.onAuthStateChanged(u => {
        if(u && u.email==='farisxuma1@gmail.com') { document.getElementById('login').style.display='none'; init(); }
    });

    function doLogin() {
        auth.signInWithEmailAndPassword(document.getElementById('a-email').value, document.getElementById('a-pass').value)
            .catch(e => alert(e.message));
    }

    function init() {
        db.collection('users').onSnapshot(snap => {
            let h = '<table><tr><th>Name</th><th>Role</th><th>Bank</th><th>Balance</th><th>Edit</th></tr>';
            snap.forEach(d => {
                const u = d.data(); users[d.id] = u;
                h += `<tr><td>${u.username}</td><td>${u.role}</td><td>${u.bankName||'-'} ${u.bankNo||''}</td><td>${u.balance.toFixed(2)}</td><td><button class="btn" style="background:blue" onclick="edit('${d.id}')">Edit</button></td></tr>`;
            });
            document.getElementById('u-list').innerHTML = h+'</table>';
        });

        db.collection('transactions').where('status','==','pending').onSnapshot(snap => {
            let h = '<table><tr><th>Type</th><th>User</th><th>Amount</th><th>Action</th></tr>';
            snap.forEach(d => {
                const t = d.data();
                h += `<tr><td>${t.type}</td><td>${users[t.uid]?.username||t.uid}</td><td>${t.amount}</td>
                <td><button class="btn" style="background:green" onclick="ok('${d.id}','${t.uid}',${t.amount},'${t.type}')">‚úî</button> <button class="btn" style="background:red" onclick="no('${d.id}')">‚úò</button></td></tr>`;
            });
            document.getElementById('tx-list').innerHTML = h+'</table>';
        });
    }

    async function edit(uid) {
        const n = prompt("‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà:");
        if(n) await db.collection('users').doc(uid).update({balance:parseFloat(n)});
    }

    async function ok(id, uid, amt, type) {
        if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?')) return;
        await db.runTransaction(async t => {
            const uRef = db.collection('users').doc(uid);
            const bal = (await t.get(uRef)).data().balance;
            if(type==='withdraw' && bal<amt) throw "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠";
            t.update(uRef, {balance: type==='deposit'?bal+amt:bal-amt});
            t.update(db.collection('transactions').doc(id), {status:'approved'});
        });
    }
    async function no(id) { await db.collection('transactions').doc(id).update({status:'rejected'}); }
    function show(p) { document.getElementById('p-users').style.display=p==='users'?'block':'none'; document.getElementById('p-tx').style.display=p==='tx'?'block':'none'; }
</script>
</body>
</html>
