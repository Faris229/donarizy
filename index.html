<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Score Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Prompt', sans-serif; background: #f1f5f9; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; }
        
        .btn { padding: 8px 15px; border-radius: 6px; border: none; cursor: pointer; color: white; font-weight: bold; }
        .btn-green { background: #10b981; } .btn-red { background: #ef4444; } .btn-blue { background: #3b82f6; } .btn-dark { background: #1e293b; }

        .match-row { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eee; padding: 15px 0; }
        .team-ctrl { text-align: center; flex: 1; }
        .score-display { font-size: 2rem; font-weight: bold; margin: 0 10px; }
        
        .ctrl-btn { width: 30px; height: 30px; border-radius: 50%; border: none; cursor: pointer; color: white; font-weight: bold; }
        .plus { background: #10b981; } .minus { background: #ef4444; }

        #login-screen { position: fixed; inset: 0; background: #0f172a; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 300px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h3>Admin Login</h3>
            <input id="email" value="farisxuma1@gmail.com" readonly>
            <input id="pass" type="password" placeholder="Password">
            <button class="btn btn-blue" onclick="login()">Login</button>
        </div>
    </div>

    <div class="container" id="app" style="display:none;">
        <h2>‚öΩ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏ö‡∏≠‡∏•</h2>
        
        <div class="card">
            <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input id="new-home" placeholder="‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤ (Home)">
                <input id="new-away" placeholder="‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô (Away)">
            </div>
            <input id="new-league" placeholder="‡∏•‡∏µ‡∏Å (‡πÄ‡∏ä‡πà‡∏ô Premier League)">
            <input id="new-time" placeholder="‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Ç‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô 19:30)">
            <button class="btn btn-green" onclick="addMatch()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>

        <div class="card">
            <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h3>
            <div id="match-list">Loading...</div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA2NTzJKFK3GtULDl-l2EvEH3VamDh-VZI",
            authDomain: "chat-27f96.firebaseapp.com",
            projectId: "chat-27f96",
            storageBucket: "chat-27f96.firebasestorage.app",
            messagingSenderId: "336686938010",
            appId: "1:336686938010:web:9ea0e0ddd8d93e8358ec23"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if(user && user.email === 'farisxuma1@gmail.com') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadMatches();
            }
        });

        async function login() {
            try { await auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value); }
            catch(e) { Swal.fire('Error','‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î','error'); }
        }

        async function addMatch() {
            const h = document.getElementById('new-home').value;
            const a = document.getElementById('new-away').value;
            const l = document.getElementById('new-league').value;
            const t = document.getElementById('new-time').value;

            if(!h || !a) return;

            await db.collection('matches').add({
                homeTeam: h, awayTeam: a, league: l || 'Friendly', time: t || '00:00',
                homeScore: 0, awayScore: 0,
                isPlaying: false, isFinished: false,
                startTime: firebase.firestore.FieldValue.serverTimestamp()
            });
            Swal.fire('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß','','success');
            document.getElementById('new-home').value = '';
            document.getElementById('new-away').value = '';
        }

        function loadMatches() {
            db.collection('matches').orderBy('startTime', 'desc').onSnapshot(snap => {
                const div = document.getElementById('match-list');
                div.innerHTML = '';
                
                snap.forEach(doc => {
                    const m = doc.data();
                    const id = doc.id;
                    
                    div.innerHTML += `
                        <div class="match-row">
                            <div class="team-ctrl">
                                <b>${m.homeTeam}</b><br>
                                <button class="ctrl-btn minus" onclick="updateScore('${id}', 'home', -1)">-</button>
                                <span class="score-display">${m.homeScore}</span>
                                <button class="ctrl-btn plus" onclick="updateScore('${id}', 'home', 1)">+</button>
                            </div>
                            
                            <div style="text-align:center; flex:1;">
                                <div style="font-size:0.8rem; color:grey;">${m.league}</div>
                                <input id="time-${id}" value="${m.time}" style="width:60px; text-align:center; padding:5px; margin:5px 0;">
                                <br>
                                <button class="btn btn-sm ${m.isPlaying?'btn-red':'btn-green'}" onclick="toggleStatus('${id}', ${m.isPlaying})">
                                    ${m.isPlaying ? 'üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤' : '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á'}
                                </button>
                                <button class="btn btn-sm btn-dark" onclick="endMatch('${id}')">üèÅ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°</button>
                            </div>

                            <div class="team-ctrl">
                                <b>${m.awayTeam}</b><br>
                                <button class="ctrl-btn minus" onclick="updateScore('${id}', 'away', -1)">-</button>
                                <span class="score-display">${m.awayScore}</span>
                                <button class="ctrl-btn plus" onclick="updateScore('${id}', 'away', 1)">+</button>
                            </div>
                            
                            <div style="margin-left:10px;">
                                <button class="btn btn-red" onclick="del('${id}')"><i class="fa-solid fa-trash"></i></button>
                                <button class="btn btn-blue" onclick="saveTime('${id}')">üíæ</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        async function updateScore(id, side, val) {
            await db.runTransaction(async t => {
                const ref = db.collection('matches').doc(id);
                const doc = await t.get(ref);
                const old = doc.data()[side + 'Score'];
                const newVal = old + val;
                if(newVal < 0) return;
                t.update(ref, { [side + 'Score']: newVal });
            });
        }

        async function toggleStatus(id, current) {
            await db.collection('matches').doc(id).update({ isPlaying: !current, isFinished: false });
        }

        async function endMatch(id) {
            if(confirm('‡∏à‡∏ö‡πÄ‡∏Å‡∏°?')) await db.collection('matches').doc(id).update({ isPlaying: false, isFinished: true, time: 'FT' });
        }
        
        async function saveTime(id) {
            const t = document.getElementById('time-'+id).value;
            await db.collection('matches').doc(id).update({ time: t });
            const Toast = Swal.mixin({toast: true, position: 'top-end', showConfirmButton: false, timer: 1000});
            Toast.fire({icon: 'success', title: '‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï'});
        }

        async function del(id) {
            if(confirm('‡∏•‡∏ö‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ?')) await db.collection('matches').doc(id).delete();
        }
    </script>
</body>
</html>
