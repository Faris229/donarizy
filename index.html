<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤ t.sabila</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #1e293b;
            padding-bottom: 60px;
        }

        .container { max-width: 800px; margin: 0 auto; }

        /* HEADER & CONTROLS */
        header {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .control-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            text-align: center;
        }

        .btn-role {
            padding: 10px 25px;
            border: 2px solid #cbd5e1;
            background: white;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-size: 16px;
            font-weight: bold;
            color: #64748b;
            margin: 5px;
            transition: all 0.2s;
        }

        .btn-role.active-ask { background-color: var(--primary); color: white; border-color: var(--primary); }
        .btn-role.active-ans { background-color: var(--success); color: white; border-color: var(--success); }

        select {
            padding: 10px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            width: 100%;
            max-width: 300px;
            margin-top: 15px;
            font-family: 'Sarabun', sans-serif;
        }

        /* CARD STYLES */
        .qa-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .section { padding: 15px 20px; position: relative; }
        .section-q { background-color: #eff6ff; border-bottom: 1px solid #e2e8f0; }
        .section-a { background-color: #f0fdf4; }

        /* Fading logic */
        .mode-ask .section-a { opacity: 0.4; pointer-events: none; filter: grayscale(1); }
        .mode-ans .section-q { opacity: 0.4; pointer-events: none; filter: grayscale(1); }

        /* Text Styles */
        .label-badge { font-size: 12px; font-weight: bold; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-bottom: 5px; }
        .badge-q { background: #dbeafe; color: #1e40af; }
        .badge-a { background: #d1fae5; color: #065f46; }

        .eng-text { font-size: 18px; font-weight: 700; color: #0f172a; margin-bottom: 5px; }
        .thai-read { color: #d97706; font-size: 14px; font-style: italic; margin-bottom: 10px; }

        /* RECORDING UI */
        .recorder-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #cbd5e1;
        }

        .btn-rec-start {
            background-color: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.2s;
        }

        .btn-rec-start:hover { background-color: #eff6ff; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î (Pulsing) */
        .btn-rec-start.recording {
            background-color: #fee2e2;
            color: var(--danger);
            border-color: var(--danger);
            animation: pulse 1.5s infinite;
        }

        .btn-rec-stop {
            background-color: var(--danger);
            border: 1px solid var(--danger);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
            align-items: center;
            gap: 5px;
        }

        .btn-rec-stop:hover { background-color: #dc2626; }

        .status-text { font-size: 12px; color: #64748b; margin-left: auto; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üéôÔ∏è ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤ t.sabila</h1>
            <p style="font-size: 13px; color: #64748b;">(‡∏Å‡∏î "‡∏´‡∏¢‡∏∏‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</p>
            <p style="font-size: 12px; color: red; margin-top:5px;">*‡∏ö‡∏ô iPhone ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏∞‡∏≠‡∏±‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</p>
        </header>

        <div class="control-box">
            <span style="font-weight:bold; color:#334155; display:block; margin-bottom:10px;">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</span>
            <button class="btn-role" id="btnAsk" onclick="setRole('ask')">üé§ ‡∏Ñ‡∏ô‡∏ñ‡∏≤‡∏°</button>
            <button class="btn-role" id="btnAns" onclick="setRole('ans')">üèÜ ‡∏Ñ‡∏ô‡∏ï‡∏≠‡∏ö</button>

            <div id="sport-selector-box" style="display:none; margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
                <span style="font-weight:bold; color:#334155;">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</span><br>
                <select id="sportSelect" onchange="renderContent()">
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ --</option>
                    <option value="football">‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• (Football)</option>
                    <option value="badminton">‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô (Badminton)</option>
                    <option value="volleyball">‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏• (Volleyball)</option>
                    <option value="basketball">‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏• (Basketball)</option>
                    <option value="swimming">‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ (Swimming)</option>
                    <option value="boxing">‡∏°‡∏ß‡∏¢ (Boxing)</option>
                </select>
            </div>
        </div>

        <div id="qa-container"></div>
    </div>

    <script>
        let currentRole = '';
        let recorders = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        let audioChunks = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏á

        const sportsDB = {
            football: { name: "Football", read: "‡∏ü‡∏∏‡∏ï-‡∏ö‡∏≠‡∏•", player: "Cristiano Ronaldo", readP: "‡∏Ñ‡∏£‡∏¥‡∏™-‡πÄ‡∏ï‡∏µ‡∏¢-‡πÇ‡∏ô ‡πÇ‡∏£-‡∏ô‡∏±‡∏•-‡πÇ‡∏î" },
            badminton: { name: "Badminton", read: "‡πÅ‡∏ö‡∏î-‡∏°‡∏¥‡∏ô-‡∏ï‡∏±‡∏ô", player: "Ratchanok Intanon", readP: "‡∏£‡∏±‡∏ä-‡∏ä‡∏∞-‡∏ô‡∏Å ‡∏≠‡∏¥‡∏ô-‡∏ó‡∏∞-‡∏ô‡∏ô" },
            volleyball: { name: "Volleyball", read: "‡∏ß‡∏≠‡∏•-‡πÄ‡∏•‡∏¢‡πå-‡∏ö‡∏≠‡∏•", player: "Nootsara Tomkom", readP: "‡∏ô‡∏∏‡∏®-‡∏£‡∏≤ ‡∏ï‡πâ‡∏≠‡∏°-‡∏Ñ‡∏≥" },
            basketball: { name: "Basketball", read: "‡∏ö‡∏≤‡∏™-‡πÄ‡∏Å‡∏ï-‡∏ö‡∏≠‡∏•", player: "LeBron James", readP: "‡πÄ‡∏•‡∏≠-‡∏ö‡∏£‡∏≠‡∏ô ‡πÄ‡∏à‡∏°‡∏™‡πå" },
            swimming: { name: "Swimming", read: "‡∏™‡∏ß‡∏¥‡∏°-‡∏°‡∏¥‡πà‡∏á", player: "Michael Phelps", readP: "‡πÑ‡∏°-‡πÄ‡∏Ñ‡∏¥‡∏• ‡πÄ‡∏ü‡∏•‡∏õ‡πå‡∏™" },
            boxing: { name: "Boxing", read: "‡∏ö‡πá‡∏≠‡∏Å-‡∏ã‡∏¥‡πà‡∏á", player: "Buakaw", readP: "‡∏ö‡∏±‡∏ß-‡∏Ç‡∏≤‡∏ß" }
        };

        const questions = [
            { id: "Q1", q: "What sport do you play?", q_r: "‡∏ß‡∏≠‡∏ó ‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï ‡∏î‡∏π ‡∏¢‡∏π ‡πÄ‡∏û‡∏•‡∏¢‡πå?", a: d => `I play ${d.name}.`, a_r: d => `‡πÑ‡∏≠ ‡πÄ‡∏û‡∏•‡∏¢‡πå ${d.read}` },
            { id: "Q2", q: "Why do you like it?", q_r: "‡∏ß‡∏≤‡∏¢ ‡∏î‡∏π ‡∏¢‡∏π ‡πÑ‡∏•‡∏Ñ‡πå ‡∏≠‡∏¥‡∏ó?", a: d => `Because it is fun.`, a_r: d => `‡∏ö‡∏µ-‡∏Ñ‡∏≠‡∏™ ‡∏≠‡∏¥‡∏ó ‡∏≠‡∏µ‡∏™ ‡∏ü‡∏±‡∏ô` },
            { id: "Q3", q: "Have you ever competed?", q_r: "‡πÅ‡∏Æ‡∏ü ‡∏¢‡∏π ‡πÄ‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏Ñ‡∏≠‡∏°-‡∏û‡∏µ‡∏ó-‡πÄ‡∏ó‡πá‡∏î?", a: d => `Yes, I have.`, a_r: d => `‡πÄ‡∏¢‡∏™, ‡πÑ‡∏≠ ‡πÅ‡∏Æ‡∏ü` },
            { id: "Q4", q: "Who is your favorite player?", q_r: "‡∏Æ‡∏π ‡∏≠‡∏µ‡∏™ ‡∏¢‡∏±‡∏ß‡∏£‡πå ‡πÄ‡∏ü-‡πÄ‡∏ß‡∏≠-‡∏£‡∏¥‡∏ó ‡πÄ‡∏û‡∏•‡∏¢‡πå-‡πÄ‡∏¢‡∏≠‡∏£‡πå?", a: d => `My favorite player is ${d.player}.`, a_r: d => `‡∏°‡∏≤‡∏¢ ‡πÄ‡∏ü-‡πÄ‡∏ß‡∏≠-‡∏£‡∏¥‡∏ó ‡πÄ‡∏û‡∏•‡∏¢‡πå-‡πÄ‡∏¢‡∏≠‡∏£‡πå ‡∏≠‡∏µ‡∏™ ${d.readP}` },
            { id: "Q5", q: "What is the benefit?", q_r: "‡∏ß‡∏≠‡∏ó ‡∏≠‡∏µ‡∏™ ‡πÄ‡∏î‡∏≠‡∏∞ ‡πÄ‡∏ö-‡πÄ‡∏ô-‡∏ü‡∏¥‡∏ï?", a: d => `It keeps me healthy.`, a_r: d => `‡∏≠‡∏¥‡∏ó ‡∏Ñ‡∏µ‡∏û‡∏™‡πå ‡∏°‡∏µ ‡πÄ‡∏Æ‡∏•-‡∏ï‡∏µ‡πâ` }
        ];

        function setRole(role) {
            currentRole = role;
            document.getElementById('btnAsk').className = role === 'ask' ? 'btn-role active-ask' : 'btn-role';
            document.getElementById('btnAns').className = role === 'ans' ? 'btn-role active-ans' : 'btn-role';
            document.getElementById('sport-selector-box').style.display = 'block';
            renderContent();
        }

        function renderContent() {
            const sportKey = document.getElementById('sportSelect').value;
            const container = document.getElementById('qa-container');
            
            if (!currentRole || !sportKey) { container.innerHTML = ''; return; }

            container.innerHTML = '';
            container.className = currentRole === 'ask' ? 'mode-ask' : 'mode-ans';
            const data = sportsDB[sportKey];

            questions.forEach((item, index) => {
                const qText = item.q;
                const aText = item.a(data);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (sanitize ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å)
                const fNameQ = `${item.id}_Question_${qText.replace(/[^a-zA-Z0-9]/g, '_')}`;
                const fNameA = `${item.id}_Answer_${data.name}`;

                const card = document.createElement('div');
                card.className = 'qa-card';
                card.innerHTML = `
                    <div class="section section-q">
                        <span class="label-badge badge-q">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${index + 1}</span>
                        <div class="eng-text">${qText}</div>
                        <div class="thai-read">‡∏≠‡πà‡∏≤‡∏ô: ${item.q_r}</div>
                        <div class="recorder-controls">
                            <button class="btn-rec-start" id="btn-start-q-${index}" onclick="startRecord(${index}, 'q', '${fNameQ}')">
                                üéôÔ∏è ‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                            </button>
                            <button class="btn-rec-stop" id="btn-stop-q-${index}" onclick="stopRecord(${index}, 'q')">
                                ‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </button>
                            <span class="status-text" id="status-q-${index}"></span>
                        </div>
                    </div>

                    <div class="section section-a">
                        <span class="label-badge badge-a">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</span>
                        <div class="eng-text">${aText}</div>
                        <div class="thai-read">‡∏≠‡πà‡∏≤‡∏ô: ${item.a_r(data)}</div>
                        <div class="recorder-controls">
                            <button class="btn-rec-start" id="btn-start-a-${index}" onclick="startRecord(${index}, 'a', '${fNameA}')">
                                üéôÔ∏è ‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                            </button>
                            <button class="btn-rec-stop" id="btn-stop-a-${index}" onclick="stopRecord(${index}, 'a')">
                                ‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </button>
                            <span class="status-text" id="status-a-${index}"></span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á ---

        async function startRecord(index, type, filename) {
            const id = `${index}-${type}`;
            const btnStart = document.getElementById(`btn-start-${id}`);
            const btnStop = document.getElementById(`btn-stop-${id}`);
            const status = document.getElementById(`status-${id}`);

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                recorders[id] = new MediaRecorder(stream);
                audioChunks[id] = [];
                recorders[id].filename = filename; // ‡∏ù‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏ß‡πâ

                recorders[id].ondataavailable = e => audioChunks[id].push(e.data);

                recorders[id].onstop = () => {
                    const blob = new Blob(audioChunks[id], { type: 'audio/wav' });
                    const url = URL.createObjectURL(blob);
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Link ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `${recorders[id].filename}.wav`;
                    document.body.appendChild(a);
                    a.click(); // ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    
                    // Cleanup
                    window.URL.revokeObjectURL(url);
                    status.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß!";
                    setTimeout(() => status.innerText = "", 3000);
                };

                recorders[id].start();

                // UI Changes
                btnStart.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î...";
                btnStart.classList.add('recording');
                btnStop.style.display = "flex"; // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î
                status.innerText = "üî¥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á...";

            } catch (err) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡∏Ñ‡πå‡πÑ‡∏î‡πâ (‡∏ö‡∏ô iPhone ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)");
                console.error(err);
            }
        }

        function stopRecord(index, type) {
            const id = `${index}-${type}`;
            const btnStart = document.getElementById(`btn-start-${id}`);
            const btnStop = document.getElementById(`btn-stop-${id}`);

            if (recorders[id] && recorders[id].state !== 'inactive') {
                recorders[id].stop();
                
                // Reset UI
                btnStart.innerHTML = "üéôÔ∏è ‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà";
                btnStart.classList.remove('recording');
                btnStop.style.display = "none";
            }
        }
    </script>
</body>
</html>
