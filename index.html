<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stadium Control | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --text: #f8fafc; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        
        /* Glass Modal Login */
        .login-overlay { 
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .login-box { 
            background: #1e293b; padding: 40px; border-radius: 20px; width: 320px; text-align: center; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);
        }
        input { 
            width: 100%; padding: 12px; margin-bottom: 15px; background: #0f172a; border: 1px solid #334155; 
            color: white; border-radius: 8px; box-sizing: border-box; 
        }
        
        .container { max-width: 900px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Card Style */
        .card { 
            background: var(--card); border-radius: 16px; padding: 25px; margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05);
        }
        
        /* Buttons with Gradient & Glow */
        .btn { 
            border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; 
            transition: all 0.3s; color: white; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .btn:active { transform: scale(0.95); }

        .btn-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
        .btn-green { background: linear-gradient(135deg, #22c55e, #16a34a); box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
        .btn-red { background: linear-gradient(135deg, #ef4444, #dc2626); box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        .btn-dark { background: #334155; }
        
        /* Match Row */
        .match-row { 
            background: #0f172a; border-radius: 12px; padding: 20px; margin-bottom: 15px; 
            border: 1px solid #334155; display: flex; flex-direction: column; gap: 15px;
        }
        .match-top { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        .score-display { font-size: 1.8rem; font-weight: bold; background: #1e293b; padding: 0 15px; border-radius: 8px; margin: 0 15px; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .team-ctrl { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; text-align: center; }
        
        .action-row { display: flex; gap: 10px; margin-top: 10px; }
        .full-btn { width: 100%; margin-bottom: 5px; }

    </style>
</head>
<body>

    <div id="login-screen" class="login-overlay">
        <div class="login-box">
            <i class="fa-solid fa-user-astronaut" style="font-size:3rem; color:var(--primary); margin-bottom:20px;"></i>
            <h3 style="margin:0 0 20px 0;">ADMIN ACCESS</h3>
            <input id="email" value="farisxuma1@gmail.com" readonly>
            <input id="pass" type="password" placeholder="Passcode">
            <button class="btn btn-blue" style="width:100%;" onclick="login()">ENTER SYSTEM</button>
        </div>
    </div>

    <div id="app" class="container" style="display:none;">
        <div class="header">
            <h2>üéõÔ∏è CONTROL CENTER</h2>
            <button class="btn btn-red" onclick="auth.signOut()"><i class="fa-solid fa-power-off"></i> LOGOUT</button>
        </div>

        <div class="card">
            <h3 style="margin-top:0;"><i class="fa-solid fa-plus-circle"></i> CREATE MATCH</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
                <input id="home" placeholder="Home Team">
                <input id="away" placeholder="Away Team">
            </div>
            <div style="display:grid; grid-template-columns: 2fr 1fr; gap:15px; margin-bottom:15px;">
                <input id="league" placeholder="League Name">
                <input id="time" type="time" style="color-scheme: dark;">
            </div>
            <button class="btn btn-green" style="width:100%;" onclick="addMatch()">PUBLISH MATCH</button>
        </div>

        <div id="match-list">Loading...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA2NTzJKFK3GtULDl-l2EvEH3VamDh-VZI",
            authDomain: "chat-27f96.firebaseapp.com",
            projectId: "chat-27f96",
            storageBucket: "chat-27f96.firebasestorage.app",
            messagingSenderId: "336686938010",
            appId: "1:336686938010:web:9ea0e0ddd8d93e8358ec23"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if(user && user.email === 'farisxuma1@gmail.com') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadMatches();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        });

        async function login() {
            try { await auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value); }
            catch(e) { Swal.fire({icon:'error', title:'Access Denied', background:'#1e293b', color:'#fff'}); }
        }

        async function addMatch() {
            const h = document.getElementById('home').value;
            const a = document.getElementById('away').value;
            const l = document.getElementById('league').value;
            const t = document.getElementById('time').value;
            if(!h || !a) return;

            await db.collection('matches').add({
                homeTeam: h, awayTeam: a, league: l || 'Friendly', time: t || '00:00',
                homeScore: 0, awayScore: 0, homeEvents: [], awayEvents: [],
                isPlaying: false, isFinished: false,
                startTime: firebase.firestore.FieldValue.serverTimestamp()
            });
            Swal.fire({icon:'success', title:'Match Created', toast:true, position:'top-end', showConfirmButton:false, timer:1500, background:'#1e293b', color:'#fff'});
            document.getElementById('home').value=''; document.getElementById('away').value='';
        }

        function loadMatches() {
            db.collection('matches').orderBy('startTime', 'desc').onSnapshot(snap => {
                const div = document.getElementById('match-list');
                div.innerHTML = '';
                snap.forEach(doc => {
                    const m = doc.data();
                    const id = doc.id;
                    const liveStyle = m.isPlaying ? 'border:1px solid #22c55e; box-shadow:0 0 10px rgba(34,197,94,0.2);' : '';

                    div.innerHTML += `
                        <div class="match-row" style="${liveStyle}">
                            <div class="match-top">
                                <div style="color:#94a3b8; font-size:0.8rem;">${m.league}</div>
                                <div style="display:flex; align-items:center;">
                                    <span style="font-weight:bold; font-size:1.2rem;">${m.homeTeam}</span>
                                    <span class="score-display">${m.homeScore} - ${m.awayScore}</span>
                                    <span style="font-weight:bold; font-size:1.2rem;">${m.awayTeam}</span>
                                </div>
                                <div style="display:flex; gap:5px;">
                                    <input id="tm-${id}" value="${m.time}" style="width:70px; text-align:center; margin:0;">
                                    <button class="btn btn-dark" style="padding:5px 10px;" onclick="saveTime('${id}')">üíæ</button>
                                </div>
                            </div>

                            <div class="controls">
                                <div class="team-ctrl">
                                    <div style="margin-bottom:10px; font-weight:bold; color:#3b82f6;">üè† HOME</div>
                                    <button class="btn btn-green full-btn" onclick="eventAction('${id}','home','goal',${m.homeScore})"><i class="fa-solid fa-futbol"></i> GOAL</button>
                                    <button class="btn btn-red full-btn" onclick="eventAction('${id}','home','red')"><i class="fa-solid fa-square"></i> RED CARD</button>
                                </div>
                                <div class="team-ctrl">
                                    <div style="margin-bottom:10px; font-weight:bold; color:#3b82f6;">‚úàÔ∏è AWAY</div>
                                    <button class="btn btn-green full-btn" onclick="eventAction('${id}','away','goal',${m.awayScore})"><i class="fa-solid fa-futbol"></i> GOAL</button>
                                    <button class="btn btn-red full-btn" onclick="eventAction('${id}','away','red')"><i class="fa-solid fa-square"></i> RED CARD</button>
                                </div>
                            </div>

                            <div class="action-row">
                                <button class="btn ${m.isPlaying?'btn-red':'btn-green'}" style="flex:1" onclick="setStatus('${id}',${!m.isPlaying},false)">${m.isPlaying?'PAUSE':'START LIVE'}</button>
                                <button class="btn btn-blue" style="flex:1" onclick="quickTime('${id}','HT')">HT</button>
                                <button class="btn btn-dark" style="flex:1" onclick="setStatus('${id}',false,true)">FT (END)</button>
                                <button class="btn btn-red" onclick="if(confirm('Delete?')) db.collection('matches').doc('${id}').delete()"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        async function eventAction(id, side, type, currentScore=0) {
            // ‡πÉ‡∏ä‡πâ SweetAlert Dark Mode
            const { value: player } = await Swal.fire({
                title: type==='goal' ? '‚öΩ GOAL SCORER' : 'üü• RED CARD',
                input: 'text',
                inputPlaceholder: 'Player Name (e.g. Messi 10\')',
                background: '#1e293b', color: '#fff',
                confirmButtonColor: type==='goal' ? '#22c55e' : '#ef4444',
                showCancelButton: true
            });

            if(player) {
                const icon = type==='goal' ? '‚öΩ' : 'üü•';
                await db.runTransaction(async t => {
                    const ref = db.collection('matches').doc(id);
                    const doc = await t.get(ref);
                    const ev = doc.data()[side+'Events'] || [];
                    ev.push(`${icon} ${player}`);
                    
                    let update = { [side+'Events']: ev };
                    if(type === 'goal') update[side+'Score'] = currentScore + 1;
                    
                    t.update(ref, update);
                });
            }
        }

        async function saveTime(id) {
            await db.collection('matches').doc(id).update({time: document.getElementById('tm-'+id).value});
        }
        async function quickTime(id, val) {
            await db.collection('matches').doc(id).update({time: val});
        }
        async function setStatus(id, play, fin) {
            let u = { isPlaying: play, isFinished: fin };
            if(fin) u.time = 'FT';
            await db.collection('matches').doc(id).update(u);
        }
    </script>
</body>
</html>
