<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ | V12 QR Code Fix</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> 
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap');

        :root {
            --bg-color: #f7fff7; 
            --container-bg: #ffffff; 
            --text-color: #333333; 
            --primary-color: #4CAF50; 
            --secondary-color: #81c784; 
            --success-color: #4CAF50; 
            --danger-color: #f44336; 
            --border-color: #e0e0e0; 
            --shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            --house-btn-color: #00bcd4; 
            --quick-btn-color: #607d8b; 
            --dice-color: #fbc02d; 
            --rent-btn-color: #ff9800; 
            --limit-color: #ff5722; 
            --chest-color: #ffc107; 
            --scan-btn-color: #2196F3; 
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            line-height: 1.6;
            touch-action: manipulation;
        }

        .container {
            background: var(--container-bg);
            border-radius: 12px;
            padding: 35px;
            box-shadow: var(--shadow);
            max-width: 650px; 
            width: 100%;
            position: relative; 
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        h2 {
            color: var(--text-color);
            font-weight: 500;
            margin-bottom: 10px;
            text-align: center;
        }

        h3, h4 {
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 25px;
            font-weight: 500;
        }
        
        .section-card {
            background-color: #ffffff;
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f0f0;
        }
        
        .card-balance {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--house-btn-color) 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0 30px 0;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            min-height: 120px;
        }
        .card-chip {
            width: 40px;
            height: 30px;
            background-color: var(--dice-color); 
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .card-logo {
            font-family: Arial, sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            position: absolute;
            top: 20px;
            right: 20px;
            opacity: 0.8;
            letter-spacing: 1px;
        }
        .card-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        #current-balance {
            font-size: 2.5em; 
            font-weight: 700;
            display: block;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .card-player-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 15px;
        }
        .card-player-info span {
            font-size: 1em;
            font-weight: 400;
        }


        input[type="text"], input[type="number"], textarea {
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 100%; 
            box-sizing: border-box;
            font-size: 16px;
            background-color: #ffffff;
            color: var(--text-color);
            resize: vertical;
        }
        input:focus, textarea:focus {
            box-shadow: 0 0 0 2px var(--secondary-color);
            outline: none;
            border-color: var(--secondary-color);
        }

        button {
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
            margin-right: 10px;
            margin-bottom: 10px;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        }
        
        button:active:not(:disabled) {
            transform: scale(0.98);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 1 !important; 
            background-color: #cccccc !important;
            color: #666666 !important; 
            cursor: not-allowed;
            box-shadow: none;
            transform: none !important;
        }
        
        .quick-amounts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px; 
            margin-bottom: 15px;
            justify-content: flex-start;
        }
        .quick-amounts button {
            background-color: var(--quick-btn-color);
            color: white;
            padding: 8px 10px;
            font-size: 14px;
            font-weight: 500;
            margin: 0;
            width: auto;
            min-width: 60px;
        }

        .add-btn {
            background-color: var(--success-color);
            width: calc(50% - 5px); 
            margin-right: 10px;
        }

        .subtract-btn {
            background-color: var(--danger-color);
            width: calc(50% - 5px);
            margin-right: 0;
        }

        .transfer-btn {
            background-color: #3f51b5; 
            width: 100%;
            margin-top: 5px;
        }
        .scan-btn {
            background-color: var(--scan-btn-color); 
            width: 100%;
            margin-top: 5px;
        }
        .qr-button-group {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .qr-button-group button {
            width: 50%;
            margin: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .qr-display {
            padding: 20px;
            background-color: var(--border-color);
            border-radius: 8px;
            margin: 15px 0;
        }
        
        #qrcodeCanvas {
            margin: 15px auto;
            width: 180px; 
            height: 180px;
            background-color: white;
            border: 2px solid var(--text-color);
            padding: 10px;
        }
        
        #custom-alert {
            position: fixed;
            bottom: 20px; 
            left: 50%; 
            transform: translate(-50%, 20px); 
            background-color: #333;
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            max-width: 90%; 
            pointer-events: none; 
        }
        #custom-alert.show {
            opacity: 1;
            transform: translate(-50%, 0); 
            pointer-events: auto; 
        }
        #custom-alert .icon {
            font-size: 1.2em;
            margin-right: 10px;
        }
        #custom-alert.success { background-color: var(--success-color); }
        #custom-alert.error { background-color: var(--danger-color); }
        #custom-alert.warning { background-color: #ffc107; color: var(--text-color); }
        #custom-alert.money { background-color: #26a69a; }
        #custom-alert.dice { background-color: #795548; }
        #custom-alert.limit { background-color: var(--limit-color); }
        
        .dice-area { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        #rollDiceBtn { background-color: var(--dice-color); color: #333; width: 100%; box-shadow: 0 2px 5px rgba(251, 192, 45, 0.5); font-size: 1.1em; }
        .dice-result { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 10px; min-height: 40px; }
        .dice-value { font-size: 2em; font-weight: 700; color: var(--text-color); display: inline-block; transition: transform 0.1s; }
        @keyframes roll-effect { 0% { transform: translateY(0) rotate(0deg); } 25% { transform: translateY(-3px) rotate(5deg); } 75% { transform: translateY(3px) rotate(-5deg); } 100% { transform: translateY(0) rotate(0deg); } }
        .dice-rolling { animation: roll-effect 0.1s infinite; }
        #total-roll { font-size: 2.5em; color: var(--primary-color); font-weight: 700; }
        .house-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        #house-count { font-weight: 700; color: var(--primary-color); font-size: 1.1em; }
        .house-input button { background-color: var(--house-btn-color); width: 100%; margin-top: 5px; margin-right: 0; box-shadow: 0 2px 5px rgba(0, 188, 212, 0.5); }
        #house-list .action-btns { display: flex; gap: 5px; flex-wrap: nowrap; }
        #house-list .rent-btn { background-color: var(--rent-btn-color); padding: 5px 8px; font-size: 13px; margin: 0; box-shadow: none; white-space: nowrap; }
        #house-list .remove-btn { background-color: #bdbdbd; padding: 5px 8px; font-size: 13px; margin: 0; color: var(--text-color); box-shadow: none; }
        #house-list, #history-list { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #house-list th, #history-list th { background-color: #f0f0f0; color: var(--primary-color); font-weight: 700; }
        #house-list th, #house-list td, #history-list th, #history-list td { border-bottom: 1px solid var(--border-color); padding: 10px; text-align: left; font-size: 0.9em; border-top: none;}
        #history-list .type-add, #history-list .type-rent-in, #history-list .type-transfer-in { color: var(--success-color); font-weight: 700; }
        #history-list .type-subtract, #history-list .type-house-buy, #history-list .type-transfer-out { color: var(--danger-color); font-weight: 700; }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 20px 0; }
        .reset-btn { background-color: var(--danger-color); width: 100%; margin-top: 30px; }
        .cooldown-status { text-align: center; color: #26a69a; font-weight: 500; margin-top: 5px; }
        
        #lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 50;
            border-radius: 12px;
            padding: 30px;
            box-sizing: border-box;
        }
        #lock-message {
            font-size: 1.5em;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 500;
        }
        #lock-overlay button {
            background-color: var(--dice-color);
            color: var(--text-color);
            margin-top: 10px;
            width: 80%;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå≥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ üå≥</h1>

        <div id="start-area" class="section-card">
            <h3>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</h3>
            <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
            <input type="number" id="startMoney" placeholder="‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" value="1500" min="0" inputmode="numeric">
            <label for="startTimeInput">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° (HH:MM):</label>
            <input type="text" id="startTimeInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô 14:30" value="14:30" maxlength="5">
            <button onclick="startGame()">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠</button>
        </div>

        <div id="game-area" style="display:none;">
            <div id="lock-overlay" style="display:none;">
                <p id="lock-message">‚è≥ ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                <button onclick="cancelTimeLock()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠)</button>
            </div>

            <div id="game-controls">
                
                <h2>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: <span id="display-name"></span></h2>

                <div class="card-balance">
                    <div class="card-logo">MONOPOLY</div>
                    <div class="card-chip"></div>
                    <div class="card-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                    <span id="current-balance">0</span>
                    <div class="card-player-info">
                        <span id="display-name-card">PLAYER NAME</span>
                        <span>CHIP: X409</span>
                    </div>
                </div>
                
                <hr>
                
                <div class="section-card">
                    <h3>üíµ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <div class="money-control-layout">
                        
                        <div class="money-input-area">
                            
                            <div class="quick-amounts">
                                <button onclick="setMoneyAmount(100)">100</button>
                                <button onclick="setMoneyAmount(500)">500</button>
                                <button onclick="setMoneyAmount(1000)">1K</button>
                                <button onclick="setMoneyAmount(5000)">5K</button>
                                <button onclick="setMoneyAmount(10000)">10K</button>
                            </div>
                            
                            <div class="input-group">
                                <input type="number" id="moneyAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö" min="1" value="100" inputmode="numeric">
                                <input type="text" id="moneyDescription" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤, ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™">
                                <button class="add-btn" onclick="addMoney()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
                                <button class="subtract-btn" onclick="subtractMoney()">- ‡∏•‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</button>
                            </div>
                        </div>

                    </div> 
                </div>

                <div class="section-card">
                    <h3>üì≤ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (QR Code)</h3>
                    <p style="font-size: 0.9em; margin-bottom: 10px;">*‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</p>
                    <input type="number" id="transferAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô" min="1" value="100" inputmode="numeric">
                    <input type="text" id="transferRecipient" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢ A)">
                    
                    <div class="qr-button-group">
                        <button class="transfer-btn" onclick="initiateTransfer()">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</button>
                        <button class="scan-btn" onclick="receiveTransfer()">‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô QR Code (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</button>
                    </div>
                    
                </div>
                
                <div class="section-card">
                    <h3>üé≤ ‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ (2 ‡∏•‡∏π‡∏Å)</h3>
                    <div class="dice-area">
                        <button id="rollDiceBtn" onclick="rollDice()">‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</button>
                        <div class="dice-result">
                            <span class="dice-value" id="dice-one-value">?</span>
                            <span class="dice-value">+</span>
                            <span class="dice-value" id="dice-two-value">?</span>
                            <span class="dice-value">=</span>
                            <span id="total-roll">0</span>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <h3>üéÅ ‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ (‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•)</h3>
                    <button id="randomEventBtn" onclick="triggerRandomEvent()">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥</button>
                    <p id="cooldown-status" class="cooldown-status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                </div>
                
                <div class="section-card">
                    <h3>üè° ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô (‡∏à‡∏≥‡∏Å‡∏±‡∏î 7 ‡∏´‡∏•‡∏±‡∏á)</h3>
                    
                    <div class="house-info">
                        <h4 style="border-bottom: none; margin-top: 0; padding-bottom: 0;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏≠‡∏á:</h4>
                        <span id="house-count">‡∏ö‡πâ‡∏≤‡∏ô: 0/7</span>
                    </div>

                    <div class="house-input">
                        <input type="text" id="houseNumber" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡πâ‡∏≤‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô">
                        <input type="number" id="housePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="1" value="200" inputmode="numeric">
                        <button id="addHouseBtn" onclick="addHouse()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</button> 
                    </div>
                    
                    <table id="house-list">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô/‡∏ö‡πâ‡∏≤‡∏ô</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                
                <hr>

                <div class="section-card">
                    <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
                    <table id="history-list">
                        <thead>
                            <tr>
                                <th style="width: 20%;">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th style="width: 25%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>

                <button class="reset-btn" onclick="resetGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</button>
            </div>
        </div>
    </div>

    <div id="custom-alert" class="hidden" onclick="this.classList.remove('show');">
        <span class="icon"></span>
        <span class="message"></span>
    </div>

    <div id="transferModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeTransferModal()">&times;</span>
            <h3>‚úÖ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>
            
            <div class="qr-display">
                <div id="qrcodeCanvas"></div> 
                
                <p><strong>‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô (‡∏Ñ‡∏∏‡∏ì):</strong> <span id="transferSender"></span></p>
                <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> <span id="transferAmountDisplay"></span> ‡∏ö‡∏≤‡∏ó</p>
                <p><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</strong> <span id="transferRecipientDisplay"></span></p>
                <p style="font-size: 0.8em; margin-top: 15px;">(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡πÉ‡∏ô QR Code ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô)</p>
            </div>
            
            <button class="transfer-btn" onclick="closeTransferModal()" style="width: 100%;">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>


    <script>
        // *** Global State ***
        let playerName = '';
        let balance = 0;
        let houses = [];
        let transactionHistory = [];
        let gameStartTime = ''; 
        let alertTimeout;
        
        let cooldownEndTime = 0; 
        let cooldownInterval; 

        // *** Constants ***
        const COOLDOWN_TIME = 180000; 
        const HOUSE_LIMIT = 7; 
        const randomEvents = [
            { title: "‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏¢‡∏∞‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ", amount: 500, type: "add", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ", amount: 1800, type: "add", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏£‡∏î‡∏Å‡∏à‡∏≤‡∏Å‡∏ç‡∏≤‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å", amount: 2000, type: "add", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡πÇ‡∏î‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà", amount: 300, type: "subtract", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô", amount: 1200, type: "subtract", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡πÇ‡∏î‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á", amount: 1000, type: "subtract", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡∏ö‡∏±‡∏ï‡∏£‡πÇ‡∏≠‡∏Å‡∏≤‡∏™: ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å 1 ‡∏ï‡∏≤", amount: 0, type: "turn-add", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡∏ö‡∏±‡∏ï‡∏£‡πÇ‡∏≠‡∏Å‡∏≤‡∏™: ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô 1 ‡∏ï‡∏≤", amount: 0, type: "turn-skip", source: "‡∏™‡∏∏‡πà‡∏°" },
            { title: "‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©: ‡πÇ‡∏î‡∏ô‡∏ï‡∏ö 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á", amount: 0, type: "penalty-physical", source: "‡∏™‡∏∏‡πà‡∏°" }, 
        ];

        // *** Element References ***
        const startArea = document.getElementById('start-area');
        const gameArea = document.getElementById('game-area');
        const displayName = document.getElementById('display-name');
        const currentBalance = document.getElementById('current-balance');
        const moneyAmountInput = document.getElementById('moneyAmount');
        const moneyDescriptionInput = document.getElementById('moneyDescription'); 
        const houseNumberInput = document.getElementById('houseNumber');
        const housePriceInput = document.getElementById('housePrice');
        const houseListBody = document.querySelector('#house-list tbody');
        const randomEventBtn = document.getElementById('randomEventBtn');
        const cooldownStatus = document.getElementById('cooldown-status');
        const historyListBody = document.querySelector('#history-list tbody');
        const startTimeInput = document.getElementById('startTimeInput');
        const lockOverlay = document.getElementById('lock-overlay');
        const lockMessage = document.getElementById('lock-message'); 
        const gameControls = document.getElementById('game-controls');
        const customAlert = document.getElementById('custom-alert');
        const customAlertIcon = customAlert.querySelector('.icon');
        const customAlertMessage = customAlert.querySelector('.message');
        const houseCountDisplay = document.getElementById('house-count');
        const addHouseBtn = document.getElementById('addHouseBtn');
        const diceOneValue = document.getElementById('dice-one-value');
        const diceTwoValue = document.getElementById('dice-two-value');
        const totalRoll = document.getElementById('total-roll');
        const rollDiceBtn = document.getElementById('rollDiceBtn');
        const displayNameCard = document.getElementById('display-name-card');
        
        // QR Transfer Elements
        const transferAmountInput = document.getElementById('transferAmount');
        const transferRecipientInput = document.getElementById('transferRecipient');
        const transferModal = document.getElementById('transferModal');
        const transferSenderDisplay = document.getElementById('transferSender');
        const transferAmountDisplay = document.getElementById('transferAmountDisplay');
        const transferRecipientDisplay = document.getElementById('transferRecipientDisplay');
        const qrcodeCanvas = document.getElementById('qrcodeCanvas');


        // --- Custom Alert ---
        function showAlert(message, type = 'info', icon = '') {
            clearTimeout(alertTimeout); 
            customAlert.classList.remove('show', 'success', 'error', 'info', 'warning', 'money', 'dice', 'limit', 'transfer');
            customAlertMessage.textContent = message;
            customAlert.classList.add(type);
            if (!icon) {
                if (type === 'success') icon = '‚úÖ';
                else if (type === 'error') icon = '‚ùå';
                else if (type === 'warning') icon = '‚ö†Ô∏è';
                else if (type === 'money') icon = 'üí∞';
                else if (type === 'dice') icon = 'üé≤';
                else if (type === 'limit') icon = 'üõë';
                else if (type === 'transfer') icon = 'üì≤';
                else icon = '‚ÑπÔ∏è'; 
            }
            customAlertIcon.textContent = icon;
            customAlert.classList.add('show');
            alertTimeout = setTimeout(() => {
                customAlert.classList.remove('show');
            }, 3000); 
        }

        // --- Core Game Functions (Omitted for brevity, assumed functional) ---
        function updateBalanceDisplay() {
            currentBalance.textContent = balance.toLocaleString('th-TH');
            displayName.textContent = playerName; 
            displayNameCard.textContent = playerName.toUpperCase(); 
        }

        function recordTransaction(type, description, amount) {
            const now = new Date();
            const timeString = `${now.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})}`;
            
            const record = {
                time: timeString,
                type: type, 
                description: description,
                amount: amount
            };
            transactionHistory.unshift(record);
            renderHistory();
        }

        function renderHistory() {
            historyListBody.innerHTML = '';
            const recentHistory = transactionHistory.slice(0, 15);

            recentHistory.forEach(record => {
                const row = historyListBody.insertRow();
                const cellTime = row.insertCell(0);
                const cellDesc = row.insertCell(1);
                const cellAmount = row.insertCell(2);

                let amountClass = record.type;
                let amountDisplay = '';

                if (record.type.includes('add') || record.type.includes('rent-in') || record.type.includes('house-sell') || record.type.includes('transfer-in')) {
                    amountDisplay = `+${record.amount.toLocaleString('th-TH')}`;
                    amountClass = 'type-add';
                } else if (record.type.includes('subtract') || record.type.includes('house-buy') || record.type.includes('transfer-out')) {
                    amountDisplay = `-${record.amount.toLocaleString('th-TH')}`; 
                    amountClass = 'type-subtract'; 
                } else if (record.type.includes('turn')) {
                    if (record.type.includes('add')) amountDisplay = "‚úÖ ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°";
                    else if (record.type.includes('skip')) amountDisplay = "‚ùå ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô";
                } else if (record.type.includes('penalty')) {
                    amountDisplay = "üíÄ ‡∏•‡∏á‡πÇ‡∏ó‡∏©";
                } else {
                    amountDisplay = "-";
                }
                
                cellTime.textContent = record.time;
                cellDesc.textContent = record.description;
                cellAmount.innerHTML = `<span class="${amountClass}">${amountDisplay}</span>`;
            });
        }
        
        function startGame() {
            const nameInput = document.getElementById('playerName').value.trim();
            const startMoneyInput = parseInt(document.getElementById('startMoney').value);
            const timeInput = startTimeInput.value.trim();

            if (nameInput === '' || isNaN(startMoneyInput) || startMoneyInput < 0) {
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå');
                return;
            }
            if (!/^\d{1,2}:\d{2}$/.test(timeInput)) {
                showAlert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (HH:MM)!', 'error', '‚ùå');
                return;
            }

            playerName = nameInput;
            balance = startMoneyInput;
            gameStartTime = timeInput; 
            transactionHistory = [];
            
            recordTransaction('start', `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏° (‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô: ${startMoneyInput.toLocaleString('th-TH')})`, startMoneyInput);
            
            updateBalanceDisplay();

            startArea.style.display = 'none';
            gameArea.style.display = 'block';

            saveData();
            checkStartTime();
            showAlert(`‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ${gameStartTime} ‡∏ô.`, 'info', '‚è∞');
        }

        function setMoneyAmount(amount) {
            moneyAmountInput.value = amount;
            moneyDescriptionInput.value = ''; 
        }

        function addMoney() { 
            const amount = parseInt(moneyAmountInput.value);
            const description = moneyDescriptionInput.value.trim() || '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á';

            if (isNaN(amount) || amount <= 0) { showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå'); return; }
            balance += amount;
            recordTransaction('add', description, amount);
            updateBalanceDisplay(); 
            moneyAmountInput.value = '100'; 
            moneyDescriptionInput.value = '';
            saveData();
            showAlert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô ${amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß!`, 'money', '‚¨ÜÔ∏è');
        }
        function subtractMoney() { 
            const amount = parseInt(moneyAmountInput.value);
            const description = moneyDescriptionInput.value.trim() || '‡∏•‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á';

            if (isNaN(amount) || amount <= 0) { showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå'); return; }
            balance -= amount;
            recordTransaction('subtract', description, amount);
            updateBalanceDisplay(); 
            moneyAmountInput.value = '100';
            moneyDescriptionInput.value = '';
            saveData();
            showAlert(`‡∏•‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ${amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß!`, 'money', '‚¨áÔ∏è');
        }


        // --- Transfer Money (QR Code Generation) ---
        function initiateTransfer() {
            const amount = parseInt(transferAmountInput.value);
            const recipient = transferRecipientInput.value.trim();

            if (isNaN(amount) || amount <= 0) { 
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå'); 
                return; 
            }
            if (recipient === '') {
                 showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö!', 'error', '‚ùå'); 
                return; 
            }
            if (balance < amount) {
                showAlert('‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô!', 'error', '‚ùå'); 
                return;
            }
            
            // 1. Deduct money and record transfer out
            balance -= amount;
            const transferID = Date.now();
            recordTransaction('transfer-out', `‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ ${recipient} (ID: ${transferID})`, amount);
            updateBalanceDisplay(); 
            saveData();

            // 2. Prepare Data for QR Code
            const qrData = `MONOPOLY_PAYMENT|${playerName}|${recipient}|${amount}`;
            
            // 3. Clear existing QR code aggressively (FIX: Ensures the library can draw fresh)
            qrcodeCanvas.innerHTML = ''; 
            while (qrcodeCanvas.firstChild) {
                qrcodeCanvas.removeChild(qrcodeCanvas.firstChild);
            }
            
            let qrCodeGenerated = false;
            if (typeof QRCode !== 'undefined') {
                 new QRCode(qrcodeCanvas, {
                    text: qrData,
                    width: 160,
                    height: 160,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
                qrCodeGenerated = true;
            } else {
                qrcodeCanvas.innerHTML = '‚ö†Ô∏è ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ QR Code ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
            }

            // 4. Display Modal
            transferSenderDisplay.textContent = playerName;
            transferAmountDisplay.textContent = amount.toLocaleString('th-TH');
            transferRecipientDisplay.textContent = recipient;
            
            transferModal.style.display = 'block';
            
            if (qrCodeGenerated) {
                showAlert(`‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ${amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success', 'üì≤');
            } else {
                 showAlert('‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß! (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï)', 'error', '‚ùå');
            }
            
            transferAmountInput.value = '100';
            transferRecipientInput.value = '';
        }

        function receiveTransfer() {
            const amountStr = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:");
            if (!amountStr) return;
            
            const amount = parseInt(amountStr.trim());
            
            if (isNaN(amount) || amount <= 0) {
                showAlert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå');
                return;
            }
            
            const sender = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:");
            if (!sender) return;

            balance += amount;
            recordTransaction('transfer-in', `‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å ${sender}`, amount);
            updateBalanceDisplay();
            saveData();
            
            showAlert(`‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô ${amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó ‡∏à‡∏≤‡∏Å ${sender} ‡πÅ‡∏•‡πâ‡∏ß!`, 'success', 'üí∏');
        }


        function closeTransferModal() {
            transferModal.style.display = 'none';
        }
        
        function addHouse() { 
            const number = houseNumberInput.value.trim();
            const price = parseInt(housePriceInput.value);
            
            if (number === '' || isNaN(price) || price <= 0) { 
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'error', '‚ùå'); 
                return; 
            }
            
            if (houses.length >= HOUSE_LIMIT) {
                showAlert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å! ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${HOUSE_LIMIT} ‡∏´‡∏•‡∏±‡∏á`, 'limit', 'üõë');
                return;
            }

            balance -= price; 

            const newHouse = { id: Date.now(), number: number, price: price };
            houses.push(newHouse); 
            
            recordTransaction('house-buy', `‡∏ã‡∏∑‡πâ‡∏≠ ${number} (‡∏£‡∏≤‡∏Ñ‡∏≤)`, price);
            
            updateBalanceDisplay();
            renderHouses();

            houseNumberInput.value = ''; 
            housePriceInput.value = '200'; 
            saveData();
            showAlert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ ${number} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${price.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß! (‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß)`, 'success', 'üè†');
        }
        
        function removeHouse(id) { 
            const houseToRemove = houses.find(house => house.id === id);
            if (houseToRemove) { 
                recordTransaction('house-sell', `‡∏Ç‡∏≤‡∏¢ ${houseToRemove.number} (‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô)`, houseToRemove.price);
                showAlert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ${houseToRemove.number} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${houseToRemove.price.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß! (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á)`, 'warning', 'üè†');
            }
            houses = houses.filter(house => house.id !== id);
            renderHouses(); 
            saveData();
        }
        
        function collectRent(id) {
            const house = houses.find(h => h.id === id);
            if (!house) return;
            
            balance += house.price;
            
            recordTransaction('rent-in', `‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ${house.number}`, house.price);
            updateBalanceDisplay();
            saveData();
            showAlert(`‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ${house.number} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${house.price.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó!`, 'money', 'üíµ');
        }


        function renderHouses() {
            houseListBody.innerHTML = '';
            houses.forEach(house => {
                const row = houseListBody.insertRow();
                const cellNumber = row.insertCell(0);
                const cellPrice = row.insertCell(1);
                const cellAction = row.insertCell(2);
                
                cellNumber.textContent = house.number;
                cellPrice.textContent = house.price.toLocaleString('th-TH');
                
                const actionDiv = document.createElement('div');
                actionDiv.className = 'action-btns';

                const rentButton = document.createElement('button');
                rentButton.className = 'rent-btn';
                rentButton.textContent = 'üíµ ‡πÄ‡∏ä‡πà‡∏≤';
                rentButton.onclick = () => collectRent(house.id);
                
                const removeButton = document.createElement('button');
                removeButton.className = 'remove-btn';
                removeButton.textContent = '‡∏Ç‡∏≤‡∏¢';
                removeButton.onclick = () => removeHouse(house.id);
                
                actionDiv.appendChild(rentButton);
                actionDiv.appendChild(removeButton);
                cellAction.appendChild(actionDiv);
            });
            
            houseCountDisplay.textContent = `‡∏ö‡πâ‡∏≤‡∏ô: ${houses.length}/${HOUSE_LIMIT}`;
            if (houses.length >= HOUSE_LIMIT) {
                addHouseBtn.disabled = true;
                addHouseBtn.textContent = `‡πÄ‡∏ï‡πá‡∏° ${HOUSE_LIMIT} ‡∏´‡∏•‡∏±‡∏á`;
                houseCountDisplay.style.color = 'var(--limit-color)';
            } else {
                addHouseBtn.disabled = false;
                addHouseBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠';
                houseCountDisplay.style.color = 'var(--primary-color)';
            }
        }
        
        function rollDice() {
            rollDiceBtn.disabled = true;
            const rollCount = 10; 
            let currentRoll = 0;
            diceOneValue.classList.add('dice-rolling');
            diceTwoValue.classList.add('dice-rolling');
            const finalDice1 = Math.floor(Math.random() * 6) + 1;
            const finalDice2 = Math.floor(Math.random() * 6) + 1;
            const finalTotal = finalDice1 + finalDice2;

            const rollInterval = setInterval(() => {
                diceOneValue.textContent = Math.floor(Math.random() * 6) + 1;
                diceTwoValue.textContent = Math.floor(Math.random() * 6) + 1;
                totalRoll.textContent = '?';
                currentRoll++;
                if (currentRoll >= rollCount) {
                    clearInterval(rollInterval);
                    diceOneValue.textContent = finalDice1;
                    diceTwoValue.textContent = finalDice2;
                    totalRoll.textContent = finalTotal;
                    diceOneValue.classList.remove('dice-rolling');
                    diceTwoValue.classList.remove('dice-rolling');
                    rollDiceBtn.disabled = false;
                    let message = `‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡πÑ‡∏î‡πâ ${finalDice1} + ${finalDice2} = **${finalTotal}**`;
                    if (finalDice1 === finalDice2) { message += " (‡πÄ‡∏ö‡∏¥‡πâ‡∏•!)"; }
                    showAlert(message, 'dice', 'üé≤');
                }
            }, 100); 
        }
        
        function startCooldownTimer() {
            if (cooldownInterval) clearInterval(cooldownInterval); 

            randomEventBtn.disabled = true;

            cooldownInterval = setInterval(() => {
                const now = Date.now();
                const timeLeftMs = cooldownEndTime - now;

                if (timeLeftMs <= 0) {
                    clearInterval(cooldownInterval);
                    cooldownEndTime = 0; 
                    saveData(); 
                    
                    randomEventBtn.disabled = false;
                    randomEventBtn.textContent = '‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥';
                    cooldownStatus.textContent = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢';
                    showAlert('‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß!', 'info', 'üéÅ');
                    return;
                }

                const timeLeft = Math.ceil(timeLeftMs / 1000); 
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const formattedTime = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                randomEventBtn.textContent = `‚è≥ ‡∏£‡∏≠... (${formattedTime})`;
                cooldownStatus.textContent = `‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô ${formattedTime}`;

            }, 1000);
        }

        function triggerRandomEvent() {
            const now = Date.now();
            
            if (cooldownEndTime > now) { 
                const timeLeft = Math.ceil((cooldownEndTime - now) / 1000);
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const formattedTime = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                showAlert(`‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á Cooldown! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠ ${formattedTime}`, 'limit', '‚è≥');
                return;
            }
            
            const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            let alertMessage = `üéÅ ‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥: ${event.title}!`;
            let alertType = 'info';
            let alertIcon = 'üéÅ';
            
            if (event.type.includes("add")) {
                balance += event.amount;
                alertMessage += ` ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ${event.amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`;
                alertType = 'money';
                alertIcon = '‚¨ÜÔ∏è';
            } else if (event.type.includes("subtract")) {
                balance -= event.amount;
                alertMessage += ` ‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô ${event.amount.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`;
                alertType = 'money';
                alertIcon = '‚¨áÔ∏è';
            } else if (event.type.includes("turn-add")) {
                alertMessage = `üéâ ${event.title}`;
                alertType = 'success';
                alertIcon = 'üé≤';
            } else if (event.type.includes("turn-skip")) {
                alertMessage = `üö´ ${event.title}`;
                alertType = 'error';
                alertIcon = 'üõë';
            } else if (event.type.includes("penalty-physical")) {
                alertMessage = `‚ò†Ô∏è ${event.title}`;
                alertType = 'error';
                alertIcon = 'üö®';
            }
            
            showAlert(alertMessage, alertType, alertIcon);
            recordTransaction(event.type, `${event.title} (‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥)`, event.amount);
            updateBalanceDisplay();
            
            cooldownEndTime = now + COOLDOWN_TIME;
            saveData();
            startCooldownTimer();
        }
        
        function saveData() {
            const data = { playerName, balance, houses, transactionHistory, gameStartTime, cooldownEndTime };
            localStorage.setItem('monopolyTrackerData', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem('monopolyTrackerData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                playerName = data.playerName || '';
                balance = data.balance || 0;
                houses = data.houses || [];
                transactionHistory = data.transactionHistory || [];
                gameStartTime = data.gameStartTime || ''; 
                cooldownEndTime = data.cooldownEndTime || 0; 

                if (playerName) {
                    updateBalanceDisplay();
                    renderHouses();
                    renderHistory();
                    startArea.style.display = 'none';
                    gameArea.style.display = 'block';
                    document.getElementById('playerName').value = playerName; 
                    document.getElementById('startMoney').value = data.balance; 
                    startTimeInput.value = data.gameStartTime || '14:30';
                    
                    const now = Date.now();
                    if (cooldownEndTime > now) {
                        startCooldownTimer();
                    } else {
                        cooldownEndTime = 0;
                        randomEventBtn.disabled = false;
                        randomEventBtn.textContent = '‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥';
                        cooldownStatus.textContent = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢';
                    }

                    if (gameStartTime) {
                        checkStartTime();
                    } else {
                        lockOverlay.style.display = 'none';
                        gameControls.style.opacity = '1';
                        gameControls.style.pointerEvents = 'auto';
                    }
                }
            }
        }

        function resetGame() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                localStorage.removeItem('monopolyTrackerData');
                location.reload(); 
            }
        }
        
        let startTimeInterval;
        function checkStartTime() {
            if (startTimeInterval) clearInterval(startTimeInterval);
            
            const [startH, startM] = gameStartTime.split(':').map(Number);
            let nextCheckTime = 1000;

            const check = () => {
                const now = new Date();
                const currentH = now.getHours();
                const currentM = now.getMinutes();
                const currentS = now.getSeconds();
                
                const currentTimeInSeconds = currentH * 3600 + currentM * 60 + currentS;
                const startTimeInSeconds = startH * 3600 + startM * 60;
                
                if (currentTimeInSeconds >= startTimeInSeconds) {
                    clearInterval(startTimeInterval);
                    gameControls.style.opacity = '1';
                    gameControls.style.pointerEvents = 'auto';
                    lockOverlay.style.display = 'none';
                    showAlert('‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß! üéâ', 'success', '‚úÖ');
                } else {
                    const diffSeconds = startTimeInSeconds - currentTimeInSeconds;
                    const hours = Math.floor(diffSeconds / 3600);
                    const minutes = Math.floor((diffSeconds % 3600) / 60);
                    const seconds = diffSeconds % 60;
                    
                    let message = `‚è≥ ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ${gameStartTime} ‡∏ô.`;
                    
                    if (hours > 0) {
                         message += `<br>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                    } else if (minutes > 0) {
                        message += `<br>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                    } else {
                        message += `<br>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                    }
                    
                    lockMessage.innerHTML = message;
                    lockOverlay.style.display = 'flex';
                    gameControls.style.opacity = '0.5';
                    gameControls.style.pointerEvents = 'none';

                    nextCheckTime = 1000;
                }
            };
            
            check();
            startTimeInterval = setInterval(check, nextCheckTime);
        }

        function cancelTimeLock() {
            if (startTimeInterval) clearInterval(startTimeInterval);
            
            gameControls.style.opacity = '1';
            gameControls.style.pointerEvents = 'auto';
            lockOverlay.style.display = 'none';
            
            gameStartTime = '';
            saveData(); 
            
            showAlert('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ üéâ', 'warning', 'üöÄ');
        }

        window.onload = loadData;
    </script>
</body>
</html>
