<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Stadium Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    
    <style>
        :root { --bg: #f1f5f9; --dark: #1e293b; --primary: #3b82f6; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        
        .login-overlay { position: fixed; inset: 0; background: var(--dark); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: white; padding: 30px; border-radius: 12px; width: 300px; text-align: center; }
        
        .container { max-width: 900px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Match Control Row */
        .match-row { border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fff; transition: 0.2s; }
        .match-row:hover { box-shadow: 0 10px 15px rgba(0,0,0,0.05); transform: translateY(-2px); }
        
        .match-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
        .teams-display { font-size: 1.2rem; font-weight: bold; color: var(--dark); }
        .score-display { font-size: 1.5rem; background: var(--dark); color: white; padding: 2px 10px; border-radius: 6px; margin: 0 10px; }
        
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .team-ctrl { text-align: center; background: #f8fafc; padding: 10px; border-radius: 8px; }
        
        .btn { border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: 0.2s; margin: 2px; }
        .btn:active { transform: scale(0.95); }
        .btn-goal { background: #10b981; color: white; width: 100%; margin-bottom: 5px; }
        .btn-red { background: #ef4444; color: white; }
        .btn-time { background: #3b82f6; color: white; }
        .btn-end { background: #1e293b; color: white; }
        
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-overlay">
        <div class="login-box">
            <h2 style="margin-top:0;">Admin Access</h2>
            <input id="email" value="farisxuma1@gmail.com" readonly style="background:#f1f5f9;">
            <input id="pass" type="password" placeholder="Password">
            <button class="btn btn-time" style="width:100%; padding:10px;" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="app" class="container" style="display:none;">
        <div class="header">
            <h2>üéõÔ∏è Stadium Control</h2>
            <button class="btn btn-red" onclick="auth.signOut()">Logout</button>
        </div>

        <div class="card">
            <h3>+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input id="home" placeholder="‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤">
                <input id="away" placeholder="‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô">
            </div>
            <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px;">
                <input id="league" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏µ‡∏Å / ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                <input id="time" type="time">
            </div>
            <button class="btn btn-goal" onclick="addMatch()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
        </div>

        <div id="match-list">Loading...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA2NTzJKFK3GtULDl-l2EvEH3VamDh-VZI",
            authDomain: "chat-27f96.firebaseapp.com",
            projectId: "chat-27f96",
            storageBucket: "chat-27f96.firebasestorage.app",
            messagingSenderId: "336686938010",
            appId: "1:336686938010:web:9ea0e0ddd8d93e8358ec23"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if(user && user.email === 'farisxuma1@gmail.com') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadMatches();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        });

        async function login() {
            try { await auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value); }
            catch(e) { Swal.fire('Error','‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î','error'); }
        }

        async function addMatch() {
            const h = document.getElementById('home').value;
            const a = document.getElementById('away').value;
            const l = document.getElementById('league').value;
            const t = document.getElementById('time').value;

            if(!h || !a) return Swal.fire('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏î‡πâ‡∏ß‡∏¢','','warning');

            await db.collection('matches').add({
                homeTeam: h, awayTeam: a, league: l || 'Friendly', time: t || '00:00',
                homeScore: 0, awayScore: 0,
                homeEvents: [], awayEvents: [], // Array ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏¢‡∏¥‡∏á
                isPlaying: false, isFinished: false,
                startTime: firebase.firestore.FieldValue.serverTimestamp()
            });
            Swal.fire('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','','success');
            document.getElementById('home').value = ''; document.getElementById('away').value = '';
        }

        function loadMatches() {
            db.collection('matches').orderBy('startTime', 'desc').onSnapshot(snap => {
                const div = document.getElementById('match-list');
                div.innerHTML = '';
                
                snap.forEach(doc => {
                    const m = doc.data();
                    const id = doc.id;
                    const liveClass = m.isPlaying ? 'border:2px solid #22c55e;' : '';
                    
                    div.innerHTML += `
                        <div class="match-row" style="${liveClass}">
                            <div class="match-info">
                                <span style="font-size:0.8rem; color:gray;">${m.league}</span>
                                <div class="teams-display">${m.homeTeam} <span class="score-display">${m.homeScore} - ${m.awayScore}</span> ${m.awayTeam}</div>
                                <div>
                                    <input id="tm-${id}" value="${m.time}" style="width:60px; text-align:center; padding:5px; margin:0;">
                                    <button class="btn btn-time" onclick="updateTime('${id}')">üíæ</button>
                                </div>
                            </div>

                            <div class="controls">
                                <div class="team-ctrl">
                                    <b>üè† ${m.homeTeam}</b>
                                    <button class="btn btn-goal" onclick="addGoal('${id}','home',${m.homeScore})">‚öΩ GOAL (+1)</button>
                                    <button class="btn btn-red" onclick="addCard('${id}','home','red')">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</button>
                                </div>
                                <div class="team-ctrl">
                                    <b>‚úàÔ∏è ${m.awayTeam}</b>
                                    <button class="btn btn-goal" onclick="addGoal('${id}','away',${m.awayScore})">‚öΩ GOAL (+1)</button>
                                    <button class="btn btn-red" onclick="addCard('${id}','away','red')">üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</button>
                                </div>
                            </div>

                            <div style="margin-top:15px; display:flex; gap:5px; border-top:1px solid #eee; padding-top:10px;">
                                <button class="btn ${m.isPlaying?'btn-red':'btn-green'}" onclick="setStatus('${id}',${!m.isPlaying},false)">
                                    ${m.isPlaying ? '‚è∏ ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤' : '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πà‡∏á'}
                                </button>
                                <button class="btn btn-time" onclick="quickTime('${id}','HT')">‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á (HT)</button>
                                <button class="btn btn-end" onclick="setStatus('${id}',false,true)">üèÅ ‡∏à‡∏ö‡πÄ‡∏Å‡∏° (FT)</button>
                                <button class="btn btn-red" style="margin-left:auto;" onclick="delMatch('${id}')"><i class="fa-solid fa-trash"></i> ‡∏•‡∏ö</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // ‚öΩ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ï‡∏π + ‡∏ñ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏¢‡∏¥‡∏á
        async function addGoal(id, side, currentScore) {
            const { value: player } = await Swal.fire({
                title: '‚öΩ ‡πÉ‡∏Ñ‡∏£‡∏¢‡∏¥‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π?',
                input: 'text',
                inputPlaceholder: '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô Messi 10\')',
                showCancelButton: true
            });

            if(player) {
                const newScore = currentScore + 1;
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° events
                await db.runTransaction(async t => {
                    const ref = db.collection('matches').doc(id);
                    const doc = await t.get(ref);
                    const events = doc.data()[side + 'Events'] || [];
                    events.push(`‚öΩ ${player}`);
                    
                    t.update(ref, {
                        [side + 'Score']: newScore,
                        [side + 'Events']: events
                    });
                });
            }
        }

        // üü• ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ö‡πÅ‡∏î‡∏á
        async function addCard(id, side, type) {
            const { value: player } = await Swal.fire({title: 'üü• ‡πÉ‡∏Ñ‡∏£‡πÇ‡∏î‡∏ô‡πÅ‡∏î‡∏á?', input: 'text', showCancelButton:true});
            if(player) {
                const ref = db.collection('matches').doc(id);
                const doc = await ref.get();
                const events = doc.data()[side + 'Events'] || [];
                events.push(`üü• ${player}`);
                await ref.update({ [side + 'Events']: events });
            }
        }

        // ‚è±Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤
        async function updateTime(id) {
            const t = document.getElementById('tm-'+id).value;
            await db.collection('matches').doc(id).update({ time: t });
        }
        async function quickTime(id, val) {
            await db.collection('matches').doc(id).update({ time: val });
        }
        async function setStatus(id, playing, finished) {
            let update = { isPlaying: playing, isFinished: finished };
            if(finished) update.time = 'FT';
            await db.collection('matches').doc(id).update(update);
        }
        async function delMatch(id) {
            if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) await db.collection('matches').doc(id).delete();
        }
    </script>
</body>
</html>
